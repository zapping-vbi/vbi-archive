dnl Process this file with autoconf to produce a configure script.
dnl $Id: configure.in,v 1.2 2000-07-05 18:09:34 mschimek Exp $

AC_INIT(main.c)

VERSION=1.8.0-pre4
AC_SUBST(VERSION)

AC_PROG_CC()
AC_CHECK_FUNCS(memalign)
AC_CHECK_LIB(tsp, main)

AC_CHECKING(for compile time optimization)

OPT="-O2 -fomit-frame-pointer"

AC_TRY_RUN([
#include "mmx.c"
int verbose = 0;
char *my_name = "configure";
int main() {
#if (__GNUC__ == 2 && __GNUC_MINOR__ >= 90)
		exit(!cpu_id(ARCH_KLAMATH));
#endif
	exit(1);
}], OPT="$OPT -march=i686",, OPT=$OPT)

AC_SUBST(OPT)

AC_PATH_XTRA
AC_CHECK_LIB(Xv, XvShmPutImage,,, $X_LIBS -lX11 -lXext)
if test "$ac_cv_lib_Xv_XvShmPutImage" = "yes"; then LIBS="$LIBS -lX11 -lXext"; fi

AC_ARG_ENABLE(test,[  --enable-test           enable test gui])
if test "$enable_test" = "yes"; then
	LIBS="$LIBS -ltk8.0 -ltcl8.0"
	AC_DEFINE(TEST_PREVIEW, 1)
	TEST_MODULES="test/test.o"
fi

AC_SUBST(TEST_MODULES)

AC_OUTPUT(Makefile video/Makefile audio/Makefile systems/Makefile test/Makefile mp1e.lsm)

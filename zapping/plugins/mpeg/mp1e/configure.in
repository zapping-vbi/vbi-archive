dnl Process this file with autoconf to produce a configure script.
dnl $Id: configure.in,v 1.11 2000-10-17 21:55:41 garetxe Exp $

AC_INIT(configure.in)
AM_INIT_AUTOMAKE(mp1e, 1.8.0-pre5)

dnl Use this in the final release, debugging info until then
dnl CFLAGS="$CFLAGS -Wall -O2 -fomit-frame-pointer"
CFLAGS="$CFLAGS -Wall -O2 -g"

AC_PROG_CC
AC_CHECK_FUNCS(memalign)
AC_CHECK_LIB(asound, main)
AC_CHECK_LIB(tsp, main)
AM_PROG_LIBTOOL

dnl should be some --cpu-arch=auto|pentium_mmx|pentium_ii|athlon|...
dnl
dnl AC_CHECKING(for compile time optimization)
dnl 
dnl OPT="-O2 -fomit-frame-pointer"
dnl 
dnl AC_TRY_RUN([
dnl #include "mmx.c"
dnl int verbose = 0;
dnl char *my_name = "configure";
dnl int main() {
dnl #if (__GNUC__ == 2 && __GNUC_MINOR__ >= 90)
dnl 		exit(!cpu_id(ARCH_KLAMATH));
dnl #endif
dnl 	exit(1);
dnl }], OPT="$OPT -march=i686",, OPT=$OPT)
dnl 
dnl AC_SUBST(OPT)

AC_MSG_CHECKING(for EsounD)
ESD_VERSION=`esd-config --version`
if test $? -eq 0; then
	AC_MSG_RESULT($ESD_VERSION)
	ESD_LIBS=`esd-config --libs`
	AC_SUBST(ESD_LIBS)
	AC_DEFINE(USE_ESD)
else
	AC_MSG_RESULT([no, ESD won't be used])
fi

AC_PATH_XTRA
AC_CHECK_LIB(Xv, XvShmPutImage,,, $X_LIBS -lX11 -lXext)
if test "$ac_cv_lib_Xv_XvShmPutImage" = "yes"; then LIBS="$LIBS -lX11 -lXext"; fi

AC_ARG_ENABLE(test,[  --enable-test           enable test gui])
if test "$enable_test" = "yes"; then
	LIBS="$LIBS -ltk8.0 -ltcl8.0"
	AC_DEFINE(TEST_PREVIEW, 1)
	TEST_MODULES="test/test.o"
fi

AC_SUBST(TEST_MODULES)

AC_OUTPUT(Makefile video/Makefile audio/Makefile vbi/Makefile systems/Makefile common/Makefile test/Makefile mp1e.lsm)

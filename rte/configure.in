dnl Process this file with autoconf to produce a configure script.
dnl $Id: configure.in,v 1.17 2002-05-09 21:05:31 mschimek Exp $

AC_INIT(configure.in)
AM_INIT_AUTOMAKE(rte, 0.5.0)
AM_CONFIG_HEADER(config.h)

AM_ACLOCAL_INCLUDE(macros)

AC_PROG_CC

dnl for automake 1.5
AS=$CC
AC_SUBST(AS)
AC_SUBST(ASFLAGS)

dnl Stupid rpm in SuSE
CFLAGS="-g -O2 -Wall -fomit-frame-pointer"

AM_PROG_LIBTOOL

test -e site_def.h || cat <<EOF >site_def.h
/* Site specific definitions */

#ifndef SITE_DEF_H
#define SITE_DEF_H
#if 1 /* EXISTS */
#endif /* EXISTS */
#endif /* SITE_DEF_H */
EOF

AC_CHECK_HEADER(linux/soundcard.h,AC_DEFINE(OSS, 1,
					    [Define if you have linux/soundcard.h]))

AC_MSG_CHECKING(for EsounD)
ESD_VERSION=`esd-config --version`
if test $? -eq 0; then
	AC_MSG_RESULT($ESD_VERSION)
	ESD_LIBS=`esd-config --libs`
	ESD_CFLAGS=`esd-config --cflags`
	AC_SUBST(ESD_CFLAGS)
	AC_SUBST(ESD_LIBS)
	AC_DEFINE(USE_ESD, 1, [Define if you have ESD.])
else
	AC_MSG_RESULT([no, ESD won't be used])
fi

dnl Build docs from the sources automagically if gtkdoc is available.
GTK_DOC_CHECK

dnl Short term plan is to have these three available
BACKEND_MP1E=no
AC_ARG_WITH(
	mp1e,
	[  --with-mp1e             Add the mp1e backend],
	BACKEND_MP1E="$withval", BACKEND_MP1E="yes")
if test "x$BACKEND_MP1E" = "xyes"; then
	AC_DEFINE(MP1E, 1, [Define if mp1e is built])
fi

BACKEND_FFMPEG=no
BACKEND_DIVX4LINUX=no

AM_CONDITIONAL(BACKEND_FFMPEG, test "x$BACKEND_FFMPEG" = "xyes")
AM_CONDITIONAL(BACKEND_MP1E, test "x$BACKEND_MP1E" = "xyes")
AM_CONDITIONAL(BACKEND_DIVX4LINUX, test "x$BACKEND_DIVX4LINUX" = "xyes")

dnl Check whether program_invocation_name exists, GNU extension
AC_CHECK_FUNCS(program_invocation_name)

dnl Add the languages which your application supports here.
ALL_LINGUAS="de"
AM_GNU_GETTEXT(, [need-ngettext])
LDFLAGS="$LDFLAGS $INTLLIBS"
AC_CHECK_FUNCS(ngettext)

AC_OUTPUT([
Makefile
intl/Makefile
common/Makefile
docs/Makefile
src/Makefile
test/Makefile
po/Makefile.in
rte.spec
])

if test ! -e mp1e/NO-CONFIGURE; then
	(cd mp1e && ./configure)
else
	echo "skipping ./mp1e -- flagged as no-configure"
fi

dnl fscking broken world
if test ! -r po/Makefile; then
	dnl Don't ask :-)
	PF="POT"
	PF=$PF"FILES"
        sed -e "/$PF =/r po/PF" po/Makefile.in > po/Makefile
fi

echo "
	Backend			Build		
	-------			-----
	mp1e			$BACKEND_MP1E
	ffmpeg			$BACKEND_FFMPEG
	divx4linux		$BACKEND_DIVX4LINUX
"
